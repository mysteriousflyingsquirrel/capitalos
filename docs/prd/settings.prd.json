{
  "version": "1.0",
  "id": "settings",
  "title": "Settings (Theme, API Keys, Platforms, Import/Export)",
  "source": "docs/requirements.md ยง 4 Settings, ยง 6 FR-4",
  "specRef": "docs/specs/settings.spec.md",
  "scope": {
    "inScope": [
      "Firestore settings schema and paths",
      "Base currency, theme, API keys persistence",
      "Platform management (add/edit/delete)",
      "Import/export backup (merge vs replace)",
      "Snapshot creation trigger from Settings UI",
      "Merge writes only, conflict handling"
    ],
    "outOfScope": []
  },
  "acceptanceCriteria": [
    "After changing theme, reloading the app MUST apply the same theme (from Firestore).",
    "Clearing an API key input and saving MUST remove that key from Firestore (field deleted).",
    "Replace mode MUST show an extra confirmation dialog before destructive import.",
    "After replace import, previously existing net worth/cashflow data not in backup MUST be deleted."
  ],
  "data": {
    "firestorePath": "users/{uid}/settings/user",
    "structure": {
      "baseCurrency": "string",
      "themeId": "string",
      "apiKeys": {
        "rapidApiKey": "optional",
        "hyperliquidWalletAddress": "optional",
        "mexcApiKey": "optional",
        "mexcSecretKey": "optional"
      }
    },
    "platformsPath": "users/{uid}/platforms/{platformId}",
    "backupSchemaVersion": "2.0.0"
  },
  "logic": {
    "writes": "MUST be merge writes only (no document overwrite).",
    "emptyApiKey": "MUST delete field using Firestore deleteField().",
    "importMerge": "setDoc with merge: true; do not clear first.",
    "importReplace": "clearAllUserData(uid) then write imported data."
  },
  "validation": {
    "importInvalidFormat": "Invalid backup file format. Please ensure the file is a valid Capitalos backup.",
    "importOffline": "Cannot import data while offline. Please check your internet connection and try again."
  }
}
