{
  "version": "1.0",
  "id": "transactions",
  "title": "Net Worth Transactions",
  "source": "docs/requirements.md ยง 4 Net Worth, ยง 6 FR-1",
  "specRef": "docs/specs/transactions.spec.md",
  "scope": {
    "inScope": [
      "Create/edit/delete NetWorthTransaction records",
      "Validation rules and error messages in UI",
      "Optimistic local state + persistence (Firestore + localStorage)",
      "Conflict detection (clientUpdatedAt)",
      "Buy/Sell/Adjustment modes and amount sign semantics"
    ],
    "outOfScope": [
      "Cashflow forecast entries",
      "Snapshot logic",
      "Exchange/perpetuals positions"
    ]
  },
  "acceptanceCriteria": [
    "Submitting with amount 0 MUST show the exact error message for the relevant mode.",
    "Negative amount in Buy/Sell mode MUST persist with side='sell' and amount stored as positive.",
    "Adjustment mode with negative amount MUST persist cryptoType='ADJUSTMENT', signed amount, pricePerItemChf=0.",
    "Categories where price is shown: blank price MUST show 'Please enter a valid price per item greater than 0.'",
    "After saving a transaction, the list MUST update immediately (optimistic) even if Firestore write fails."
  ],
  "data": {
    "model": "NetWorthTransaction",
    "requiredFields": ["id", "itemId", "date", "currency", "amount", "side", "pricePerItemChf"],
    "dateFormat": "YYYY-MM-DD",
    "firestorePath": "users/{uid}/netWorthTransactions/{transactionId}",
    "localStorageKeys": ["capitalos:${uid}:netWorthTransactions", "capitalos_netWorthTransactions_v1"]
  },
  "logic": {
    "amountSign": {
      "buySell": "Input amount > 0 => side='buy', amount=Math.abs(input); input < 0 => side='sell', amount=Math.abs(input). cryptoType BUY/SELL consistent.",
      "adjustment": "amount preserves sign, cryptoType='ADJUSTMENT', pricePerItemChf=0, pricePerItem=0, side still 'buy' if amount>0 else 'sell'."
    },
    "categoriesWithoutPricePerItem": ["Cash", "Bank Accounts", "Retirement Funds", "Real Estate", "Perpetuals"],
    "priceRule": "For those categories store pricePerItem=1, pricePerItemChf=1; do not require price input."
  },
  "validation": {
    "addItem": {
      "nameBlank": "Please enter an item name.",
      "dateMissing": "Please select a date.",
      "amountInvalid": "Please enter a valid amount (can be positive for buy or negative for sell).",
      "priceInvalid": "Please enter a valid price per item greater than 0.",
      "depreciationInvalid": "Please enter a valid monthly depreciation amount greater than 0."
    },
    "addEditTransaction": {
      "dateMissing": "Please select a date.",
      "buySellAmount": "Please enter a valid amount (positive for buy, negative for sell).",
      "buySellPrice": "Please enter a valid price per item greater than 0.",
      "adjustmentAmount": "Please enter a valid amount (can be positive or negative, but not zero)."
    }
  },
  "conflict": {
    "rejectReason": "existing_document_newer when remote updatedAt > clientUpdatedAt",
    "optionalReject": "recent_write_by_another_device when clientUpdatedAt not provided and doc updated by another device within 5s"
  }
}
