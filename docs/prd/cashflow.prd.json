{
  "version": "1.0",
  "id": "cashflow",
  "title": "Cashflow (Inflow, Outflow, Accountflow)",
  "source": "docs/requirements.md ยง 4 Cashflow, ยง 6 FR-2",
  "specRef": "docs/specs/cashflow.spec.md",
  "scope": {
    "inScope": [
      "Inflow/outflow items and accountflow mappings",
      "Monthly inflow/outflow/spare change computation",
      "Create/edit/delete items and mappings",
      "Persistence Firestore + localStorage, conflict-safe upserts",
      "Dashboard monthly cashflow KPI and Analytics forecast interaction"
    ],
    "outOfScope": [
      "Net worth transactions",
      "Snapshot logic"
    ]
  },
  "acceptanceCriteria": [
    "Submitting inflow/outflow with amount 0 MUST show the exact validation message.",
    "On Dashboard, spare change MUST equal sum(inflow.amountChf) - sum(outflow.amountChf) for loaded data.",
    "Account-to-account mapping with same source/target MUST show 'Source and target platforms must be different.'",
    "Adding an inflow item MUST immediately appear in the UI list before Firestore write completes."
  ],
  "data": {
    "inflowGroups": ["Time", "Service", "Worker Bees"],
    "outflowGroups": ["Fix", "Variable", "Shared Variable", "Investments"],
    "firestorePaths": {
      "inflow": "users/{uid}/cashflowInflowItems/{id}",
      "outflow": "users/{uid}/cashflowOutflowItems/{id}",
      "mappings": "users/{uid}/cashflowAccountflowMappings/{id}",
      "platforms": "users/{uid}/platforms/{id}"
    }
  },
  "logic": {
    "amountSign": "Inflow and outflow amounts MUST be > 0; UI MUST reject zero and negative.",
    "conversion": "If amount and currency present, display via CurrencyContext.convert; else fall back to amountChf.",
    "spareChange": "Per platform: totalInflowToAccount - totalOutflowFromAccount (forecastCalculationService)."
  },
  "validation": {
    "inflow": {
      "nameMissing": "Please enter an item name.",
      "amountInvalid": "Please enter a valid inflow amount greater than 0.",
      "providerMissing": "Please enter a provider."
    },
    "outflow": {
      "nameMissing": "Please enter an item name.",
      "amountInvalid": "Please enter a valid outflow amount greater than 0.",
      "receiverMissing": "Please enter a receiver."
    },
    "mapping": {
      "inflowGroup": "Please select an inflow group.",
      "inflowItem": "Please select an inflow item.",
      "targetPlatform": "Target platform is required.",
      "sourcePlatform": "Source platform is required.",
      "outflowGroup": "Please select an outflow group.",
      "outflowItem": "Please select an outflow item.",
      "samePlatforms": "Source and target platforms must be different.",
      "amountInvalid": "Please enter a valid amount greater than 0."
    }
  }
}
