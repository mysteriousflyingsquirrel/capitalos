{
  "version": "1.0",
  "id": "security-privacy",
  "title": "Security & Privacy",
  "source": "docs/requirements.md § 11 Security & Privacy",
  "specRef": "docs/specs/security-privacy.spec.md",
  "scope": {
    "inScope": [
      "Authentication requirements and flow",
      "Firestore rules (user-scoped access)",
      "API key storage, masking, logging",
      "Incognito mode (masking rules)",
      "Offline/safe-mode write blocking"
    ],
    "outOfScope": []
  },
  "acceptanceCriteria": [
    "When signed out, navigating to an authenticated route MUST show Login (no data rendered).",
    "With incognito enabled, formatMoney-rendered values MUST display '****'.",
    "When browser is offline, attempting to save a setting MUST fail with an error and not write to Firestore."
  ],
  "data": {
    "apiKeysPath": "users/{uid}/settings/user → apiKeys",
    "incognitoStorageKey": "capitalos_incognito_v1"
  },
  "logic": {
    "auth": "User data reads/writes MUST require authenticated user. Unauthenticated MUST NOT read/write users/{userId}.",
    "firestoreRules": "request.auth != null AND request.auth.uid == userId for users/{userId}/**.",
    "apiKeys": "Stored only in Firestore settings; merge writes. Empty input MUST delete field.",
    "incognito": "formatMoney/formatNumber MUST return '****' when enabled.",
    "offline": "When online === false, writes MUST be blocked. When safeMode === true, writes MUST be blocked."
  }
}
